@page "{workOrderId:int}"
@model Keswa.Pages.Tracking.WorkOrderLifecycleModel
@{
    ViewData["Title"] = $"دورة حياة أمر الشغل - {Model.WorkOrder?.WorkOrderNumber}";
}

<div class="mb-4">
    <h1 class="h2 fw-bold">@ViewData["Title"]</h1>
    <p class="text-muted">تتبع مراحل أمر الشغل عبر أقسام الإنتاج المختلفة.</p>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0 fw-bold"><i class="bi bi-info-circle-fill me-2"></i> بيانات أمر الشغل</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">رقم أمر الشغل</dt>
                    <dd class="col-sm-8"><strong>@Model.WorkOrder.WorkOrderNumber</strong></dd>

                    <dt class="col-sm-4">الموديل</dt>
                    <dd class="col-sm-8">@Model.WorkOrder.Product?.Name</dd>

                    <dt class="col-sm-4">الكمية المطلوبة</dt>
                    <dd class="col-sm-8">@Model.WorkOrder.QuantityToProduce قطعة</dd>

                    <dt class="col-sm-4">الحالة</dt>
                    <dd class="col-sm-8"><span class="badge bg-secondary">@Model.WorkOrder.Status</span></dd>

                    <dt class="col-sm-4">تاريخ الأمر</dt>
                    <dd class="col-sm-8">@Model.WorkOrder.CreationDate.ToString("yyyy-MM-dd")</dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<div class="timeline">
    <div class="timeline-item">
        <div class="timeline-marker"></div>
        <div class="timeline-content card shadow-sm border-0">
            <div class="card-header bg-info text-dark">
                <h5 class="mb-0 fw-bold"><i class="bi bi-scissors me-2"></i> مرحلة القص</h5>
            </div>
            <div class="card-body">
                @if (!Model.CuttingStatements.Any())
                {
                    <p class="text-muted">لم يتم إنشاء بيانات قص لهذا الأمر بعد.</p>
                }
                else
                {
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>رقم البيان</th>
                                <th class="text-center">الكمية</th>
                                <th>الحالة</th>
                                <th>تاريخ الإنشاء</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var statement in Model.CuttingStatements)
                            {
                                <tr>
                                    <td>@statement.StatementNumber</td>
                                    <td class="text-center">@statement.Quantity</td>
                                    <td>@statement.Status</td>
                                    <td>@statement.CreationDate.ToString("yyyy-MM-dd")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>

    <div class="timeline-item">
        <div class="timeline-marker"></div>
        <div class="timeline-content card shadow-sm border-0">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0 fw-bold"><i class="bi bi-cassette me-2"></i> مرحلة الخياطة</h5>
            </div>
            <div class="card-body">
                @if (!Model.SewingAssignments.Any())
                {
                    <p class="text-muted">لم يتم تسليم أي تشغيلات خياطة للعمال بعد.</p>
                }
                else
                {
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>العامل</th>
                                <th>الكمية المسلمة</th>
                                <th class="text-success">المستلم (سليم)</th>
                                <th class="text-danger">الهالك</th>
                                <th class="fw-bold">المتبقي</th>
                                <th>الحالة</th>
                                <th>تاريخ التسليم</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var assignment in Model.SewingAssignments)
                            {
                                <tr>
                                    <td>@assignment.WorkerName</td>
                                    <td>@assignment.AssignedQuantity</td>
                                    <td class="text-success">@assignment.ReceivedQuantity</td>
                                    <td class="text-danger">@assignment.ScrappedQuantity</td>
                                    <td class="fw-bold">@assignment.RemainingQuantity</td>
                                    <td>@assignment.Status</td>
                                    <td>@assignment.AssignmentDate.ToString("yyyy-MM-dd")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>

    <div class="timeline-item">
        <div class="timeline-marker"></div>
        <div class="timeline-content card shadow-sm border-0">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0 fw-bold"><i class="bi bi-gem me-2"></i> مرحلة التشطيب</h5>
            </div>
            <div class="card-body">
                @if (!Model.FinishingAssignments.Any())
                {
                    <p class="text-muted">لم يتم تسليم أي تشغيلات تشطيب للعمال بعد.</p>
                }
                else
                {
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>العامل</th>
                                <th>الكمية المسلمة</th>
                                <th class="text-success">المستلم (سليم)</th>
                                <th class="fw-bold">المتبقي</th>
                                <th>الحالة</th>
                                <th>تاريخ التسليم</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var assignment in Model.FinishingAssignments)
                            {
                                <tr>
                                    <td>@assignment.WorkerName</td>
                                    <td>@assignment.AssignedQuantity</td>
                                    <td class="text-success">@assignment.ReceivedQuantity</td>
                                    <td class="fw-bold">@assignment.RemainingQuantity</td>
                                    <td>@assignment.Status</td>
                                    <td>@assignment.AssignmentDate.ToString("yyyy-MM-dd")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>

    <div class="timeline-item">
        <div class="timeline-marker"></div>
        <div class="timeline-content card shadow-sm border-0">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0 fw-bold"><i class="bi bi-box-seam me-2"></i> المخزن</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">لم يتم تحويل الإنتاج للمخزن بعد.</p>
            </div>
        </div>
    </div>
</div>
<style>
    .timeline {
        position: relative;
        padding: 20px 0;
    }

        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #e9ecef;
            left: 30px;
            margin-left: -2px;
        }

    .timeline-item {
        position: relative;
        margin-bottom: 30px;
        padding-left: 60px;
    }

    .timeline-marker {
        position: absolute;
        left: 30px;
        top: 5px;
        width: 15px;
        height: 15px;
        background: #adb5bd;
        border-radius: 50%;
        margin-left: -7.5px;
        z-index: 1;
    }

    .timeline-item:first-child .timeline-marker {
        background: #0dcaf0;
    }
    .timeline-item:nth-child(2) .timeline-marker {
        background: #ffc107;
    }
    .timeline-item:nth-child(3) .timeline-marker {
        background: #198754;
    }
    .timeline-item:nth-child(4) .timeline-marker {
        background: #6c757d;
    }

    .timeline-content {
        position: relative;
    }
</style>
