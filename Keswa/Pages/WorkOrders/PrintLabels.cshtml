@page "{id:int}"
@model Keswa.Pages.WorkOrders.PrintLabelsModel
@{
    Layout = "/Pages/Shared/_PrintLayout.cshtml";
    ViewData["Title"] = "طباعة ملصقات QR Code";
}

<style>
    .label-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        width: 100%;
    }

    .label {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
        font-family: 'Tajawal', sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .qr-code-container {
        width: 100px;
        height: 100px;
        margin-bottom: 8px;
    }

    .label-info {
        font-size: 10px;
        line-height: 1.4;
    }

    .print-button-container {
        text-align: center;
        margin: 20px 0;
    }

    @@media print {
        body {
            -webkit-print-color-adjust: exact;
        }

        .print-button-container, .no-print {
            display: none !important;
        }

        .label-grid {
            page-break-inside: auto;
        }

        .label {
            page-break-inside: avoid;
        }
    }
</style>

<div class="print-button-container">
    <h3 class="no-print">معاينة ملصقات أمر الشغل: @Model.WorkOrder.WorkOrderNumber</h3>
    <p class="no-print">جاهز للطباعة: @Model.Labels.Count ملصق</p>
    <button onclick="window.print()" class="btn btn-primary no-print"><i class="bi bi-printer-fill me-2"></i>طباعة</button>
</div>

<div class="label-grid">
    @foreach (var label in Model.Labels)
    {
        <div class="label">
            <div class="qr-code-container" data-qr-data="@label.QrCodeData"></div>
            <div class="label-info">
                <strong>@label.ProductName</strong><br>
                <span>@label.WorkOrderNumber</span><br>
                <span>@label.SerialNumber</span><br>
                <span>@label.QualityGrade</span>
            </div>
        </div>
    }
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const qrContainers = document.querySelectorAll('.qr-code-container');
        qrContainers.forEach(container => {
            const data = container.getAttribute('data-qr-data');
            new QRCode(container, {
                text: data,
                width: 100,
                height: 100,
                correctLevel: QRCode.CorrectLevel.H
            });
        });
    });
</script>
